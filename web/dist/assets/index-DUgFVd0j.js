(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class C{constructor(){this.allSkins=[]}async loadData(){try{const e=await fetch("/data/skins_all.json");if(!e.ok)throw new Error(`Failed to fetch data: ${e.status} ${e.statusText}`);return this.allSkins=await e.json(),console.log(`[DataManager] Loaded ${this.allSkins.length} skins from JSON.`),this.allSkins}catch(e){throw console.error("[DataManager] Error loading data:",e),e}}}class k{constructor(e){this.allSkins=e.map(t=>({...t,_searchStr:`${t.champion} ${t.skin_name}`.toLowerCase()}))}applyFilters(e,t,n,s,i){let a=this.allSkins.filter(r=>!(e&&!r._searchStr.includes(e)||t&&r.champion!==t||n==="chromas"&&!r.isChroma||n==="prestige"&&!r.isPrestige||n==="esports"&&!r.isEsports||n==="favorites"&&!i.has(r.skin_id)));return s!=="default"&&a.sort((r,d)=>{switch(s){case"date-newest":return(d.release_date||"").localeCompare(r.release_date||"");case"date-oldest":return(r.release_date||"").localeCompare(d.release_date||"");case"price-high":return(d.price||0)-(r.price||0);case"price-low":return(r.price||0)-(d.price||0);case"name-az":return r.skin_name.localeCompare(d.skin_name);default:return 0}}),a}}const g={ULTIMATE:"ultimate",LEGENDARY:"legendary",EPIC:"epic",MYTHIC:"mythic",PRESTIGE:"prestige",HEXTECH:"hextech",CHROMA:"chroma",COLLECTION:"collection"};class E{static getBadges(e){const t=[];e.price>=3250?t.push({type:g.ULTIMATE,label:"Ultimate"}):e.price>=1820?t.push({type:g.LEGENDARY,label:"Legendary"}):e.price>=1350?t.push({type:g.EPIC,label:"Epic"}):e.isPrestige&&t.push({type:g.MYTHIC,label:"Mythic"}),e.isPrestige&&t.push({type:g.PRESTIGE,label:"Prestige"}),e.skin_name.includes("Hextech")&&t.push({type:g.HEXTECH,label:"Hextech"}),e.isChroma&&t.push({type:g.CHROMA,label:"Chromas"});const n=["K/DA","PROJECT","Star Guardian","Coven","Spirit Blossom","Blood Moon","High Noon","Pool Party","Bewitching","Snow Moon","Arcana"];for(const s of n)if(e.skin_name.includes(s)){t.push({type:g.COLLECTION,label:s});break}return t}static createBadgeElement(e){const t=document.createElement("span");return t.className=`badge badge-${e.type}`,t.textContent=e.label,t}}class B{constructor(e){this.favorites=e}createCardElement(e,t,n){const s=this.favorites.has(e.skin_id),i=document.createElement("div");i.className="skin-card",i.dataset.skinId=e.skin_id,i.setAttribute("tabindex","0"),i.setAttribute("role","button"),i.setAttribute("aria-label",`View details for ${e.skin_name}`);const a=document.createElement("button");a.className=`skin-card-favorite ${s?"active":""}`,a.dataset.skinId=e.skin_id,a.title=s?"Remove from Favorites":"Add to Favorites",a.setAttribute("aria-label",s?"Remove from Favorites":"Add to Favorites"),a.innerHTML=`
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true" style="pointer-events: none;">
                <path d="M10 3.5L12 8L17 8.5L13.5 12L14.5 17L10 14.5L5.5 17L6.5 12L3 8.5L8 8L10 3.5Z" stroke="currentColor" stroke-width="2" fill="${s?"currentColor":"none"}"/>
            </svg>
        `;const r=document.createElement("div");r.className="skin-card-image-wrapper";const d=document.createElement("img");d.className="skin-card-image",d.src=e.imagePath,d.alt="",d.loading="lazy",r.appendChild(d);const f=E.getBadges(e);if(f.length>0){const o=document.createElement("div");o.className="skin-card-badges",f.forEach(c=>{o.appendChild(E.createBadgeElement(c))}),r.appendChild(o)}const m=document.createElement("div");m.className="skin-card-info";const h=document.createElement("div");h.className="skin-card-title",h.textContent=e.skin_name;const l=document.createElement("div");if(l.className="skin-card-champion",l.textContent=e.champion,m.appendChild(h),m.appendChild(l),e.price){const o=document.createElement("div");o.className="skin-card-price",o.textContent=`${e.price} RP`,m.appendChild(o)}return i.appendChild(a),i.appendChild(r),i.appendChild(m),i}}class L{constructor(e,t){this.favorites=e,this.toggleFavoriteCallback=t,this.modal=document.getElementById("skinModal"),this.adminModal=document.getElementById("adminModal"),this.init()}init(){const e=document.getElementById("closeModal");e&&e.addEventListener("click",()=>this.close()),this.modal&&this.modal.addEventListener("click",s=>{s.target.classList.contains("modal-overlay")&&this.close()});const t=document.getElementById("modalFavorite");t&&t.addEventListener("click",()=>{const s=document.getElementById("modalSkinId").textContent;s&&this.toggleFavoriteCallback&&(this.toggleFavoriteCallback(s),this.favorites.has(s)?t.classList.add("active"):t.classList.remove("active"))});const n=document.getElementById("closeAdmin");n&&n.addEventListener("click",()=>{this.adminModal&&(this.adminModal.style.display="none")}),this.adminModal&&this.adminModal.addEventListener("click",s=>{s.target===this.adminModal&&(this.adminModal.style.display="none")})}open(e){if(!this.modal)return;const t=e;document.getElementById("modalImage").src=t.imagePath,document.getElementById("modalTitle").textContent=t.skin_name,document.getElementById("modalChampion").textContent=t.champion,document.getElementById("modalSkinId").textContent=t.skin_id,document.getElementById("modalSkinNum").textContent=t.skin_num;const n=document.getElementById("modalPriceRow");n&&(t.price>0&&t.price<99999?(n.style.display="flex",document.getElementById("modalPrice").textContent=`${t.price} RP`):n.style.display="none"),this.updateReleaseDate(t);const s=document.getElementById("modalBadges");s.innerHTML="",E.getBadges(t).forEach(d=>{s.appendChild(E.createBadgeElement(d))}),this.updateYouTubeLink(t);const a=document.getElementById("modalFavorite");a&&(this.favorites.has(t.skin_id)?(a.classList.add("active"),a.setAttribute("aria-pressed","true")):(a.classList.remove("active"),a.setAttribute("aria-pressed","false"))),this.modal.classList.add("active"),this.modal.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const r=document.getElementById("closeModal");r&&r.focus()}close(){this.modal&&(this.modal.classList.remove("active"),this.modal.setAttribute("aria-hidden","true")),this.adminModal&&(this.adminModal.style.display="none"),document.body.style.overflow=""}updateYouTubeLink(e){const t=document.getElementById("modalYouTubeLink");if(!t)return;t.style.display="inline-flex";let n="";e.skin_name.toLowerCase().includes("default")||e.skin_name.toLowerCase().includes("original")?n=`League of Legends ${e.champion} Base Skin Spotlight`:e.skin_name.toLowerCase().includes(e.champion.toLowerCase())?n=`League of Legends ${e.skin_name} Skin Spotlight`:n=`League of Legends ${e.skin_name} ${e.champion} Skin Spotlight`,t.href=`https://www.youtube.com/results?search_query=${encodeURIComponent(n)}`}async updateReleaseDate(e){const t=document.getElementById("modalReleaseDateRow");if(t){document.getElementById("modalReleaseDate").textContent="Loading date...",t.style.display="flex";try{const n=await fetch(`https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/skins/${e.skin_id}/${e.skin_id}.json`);if(n.ok){const s=await n.json();if(s.releaseDate){const a=new Date(s.releaseDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});document.getElementById("modalReleaseDate").textContent=a}else document.getElementById("modalReleaseDate").textContent="Unknown"}else throw new Error("API 404")}catch(n){console.log("Could not fetch date",n),document.getElementById("modalReleaseDate").textContent="N/A"}}}}class I{constructor(){this.dataManager=new C,this.filterEngine=null,this.skinCardV=null,this.modal=null,this.allSkins=[],this.filteredSkins=[],this.currentFilter="all",this.currentChampion="",this.searchQuery="",this.currentSort="default",this.isBrowseLoaded=!1,this.favorites=new Set(JSON.parse(localStorage.getItem("skinFavorites")||"[]")),this.skinCardV=new B(this.favorites),this.modal=new L(this.favorites,e=>this.toggleFavorite(e)),this.initialize()}async initialize(){try{this.allSkins=await this.dataManager.loadData(),this.filterEngine=new k(this.allSkins),this.filteredSkins=[...this.allSkins],this.populateChampionFilter(),this.setupEventListeners(),this.setupEventDelegation(),this.updateStats()}catch(e){console.error("Initialization failed",e);const t=document.getElementById("skinsGrid");t&&(t.innerHTML='<div class="error-message">Failed to load skins. Please ensure the data server is running.</div>')}}populateChampionFilter(){const e=[...new Set(this.allSkins.map(n=>n.champion))].sort(),t=document.getElementById("championFilter");t&&e.forEach(n=>{const s=document.createElement("option");s.value=n,s.textContent=n,t.appendChild(s)})}setupEventListeners(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",()=>{document.body.dataset.theme,document.body.classList.toggle("light-theme");const l=document.body.classList.contains("light-theme");e.querySelector(".sun-icon").style.display=l?"none":"block",e.querySelector(".moon-icon").style.display=l?"block":"none"});const t=document.getElementById("homeBtn");t&&t.addEventListener("click",()=>this.showSection("heroSection"));const n=document.getElementById("browseBtn");n&&n.addEventListener("click",()=>this.loadAndShowBrowse());const s=document.getElementById("heroBrowseBtn");s&&s.addEventListener("click",()=>this.loadAndShowBrowse());const i=document.getElementById("searchInput"),a=document.getElementById("clearSearch");i.addEventListener("input",l=>{this.searchQuery=l.target.value.toLowerCase(),a.style.display=this.searchQuery?"block":"none",this.applyFilters()}),a.addEventListener("click",()=>{i.value="",this.searchQuery="",a.style.display="none",this.applyFilters()}),document.querySelectorAll(".filter-chip").forEach(l=>{l.addEventListener("click",o=>{const c=o.target.closest(".filter-chip");c&&(document.querySelectorAll(".filter-chip").forEach(u=>u.classList.remove("active")),c.classList.add("active"),this.currentFilter=c.dataset.filter,this.applyFilters())})});const r=document.getElementById("favoritesBtn");r&&r.addEventListener("click",()=>{this.showSection("browseSection"),this.isBrowseLoaded||(this.isBrowseLoaded=!0),document.querySelectorAll(".filter-chip").forEach(o=>o.classList.remove("active"));const l=document.querySelector('.filter-chip[data-filter="favorites"]');l&&l.classList.add("active"),this.currentFilter="favorites",this.applyFilters()}),document.getElementById("championFilter").addEventListener("change",l=>{this.currentChampion=l.target.value,this.applyFilters()});const d=document.getElementById("sortControl");d&&d.addEventListener("change",l=>{this.currentSort=l.target.value,this.applyFilters()}),document.addEventListener("keydown",l=>{l.key==="Escape"&&this.modal.close()});const f=document.getElementById("adminTrigger"),m=document.getElementById("adminModal");f&&m&&f.addEventListener("click",()=>{m.style.display="flex",this.updateAdminStats()});const h=document.getElementById("closeAdmin");h&&h.addEventListener("click",()=>{m.style.display="none"})}showSection(e){document.getElementById("heroSection").style.display="none",document.getElementById("browseSection").style.display="none",document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),e==="heroSection"?(document.getElementById("heroSection").style.display="block",document.getElementById("homeBtn").classList.add("active")):e==="browseSection"&&(document.getElementById("browseSection").style.display="block",document.getElementById("browseBtn").classList.add("active")),window.scrollTo(0,0)}loadAndShowBrowse(){this.isBrowseLoaded||(this.applyFilters(),this.isBrowseLoaded=!0),this.showSection("browseSection")}toggleFavorite(e){this.favorites.has(e)?this.favorites.delete(e):this.favorites.add(e),localStorage.setItem("skinFavorites",JSON.stringify([...this.favorites])),this.updateStats()}applyFilters(){this.filterEngine&&(this.filteredSkins=this.filterEngine.applyFilters(this.searchQuery,this.currentChampion,this.currentFilter,this.currentSort,this.favorites),this.renderSkins())}renderSkins(){const e=document.getElementById("skinsGrid"),t=document.getElementById("loadingState"),n=document.getElementById("emptyState");if(t&&(t.style.display="none"),this.filteredSkins.length===0){e.innerHTML="",n&&(n.style.display="flex");return}n&&(n.style.display="none"),e.innerHTML="",this.currentRenderCount=0,this.CHUNK_SIZE=50,this.observerSentinel=document.createElement("div"),this.observerSentinel.className="scroll-sentinel",this.observerSentinel.style.height="20px",this.observerSentinel.style.width="100%",this.renderNextChunk(),this.scrollObserver&&this.scrollObserver.disconnect(),this.scrollObserver=new IntersectionObserver(s=>{s[0].isIntersecting&&this.renderNextChunk()},{rootMargin:"200px"}),e.appendChild(this.observerSentinel),this.scrollObserver.observe(this.observerSentinel)}renderNextChunk(){const e=document.getElementById("skinsGrid");if(this.currentRenderCount>=this.filteredSkins.length){this.scrollObserver&&this.scrollObserver.disconnect(),this.observerSentinel&&(this.observerSentinel.style.display="none");return}const t=this.filteredSkins.slice(this.currentRenderCount,this.currentRenderCount+this.CHUNK_SIZE),n=document.createDocumentFragment();t.forEach(s=>{const i=this.skinCardV.createCardElement(s);n.appendChild(i)}),this.observerSentinel&&this.observerSentinel.parentNode===e?e.insertBefore(n,this.observerSentinel):e.appendChild(n),this.currentRenderCount+=t.length}setupEventDelegation(){const e=document.getElementById("skinsGrid");e&&(e.addEventListener("click",t=>{const n=t.target.closest(".skin-card-favorite");if(n){t.stopPropagation();const i=n.dataset.skinId;if(i){this.toggleFavorite(i),n.classList.toggle("active");const a=n.querySelector("svg path");a&&(n.classList.contains("active")?(a.setAttribute("fill","currentColor"),n.setAttribute("aria-label","Remove from Favorites"),n.title="Remove from Favorites"):(a.setAttribute("fill","none"),n.setAttribute("aria-label","Add to Favorites"),n.title="Add to Favorites"))}return}const s=t.target.closest(".skin-card");if(s){const i=s.dataset.skinId;if(i){const a=this.getSkinById(i);a&&this.modal&&this.modal.open(a)}}}),e.addEventListener("keydown",t=>{if(t.key==="Enter"||t.key===" "){const n=t.target.closest(".skin-card-favorite");if(n){t.preventDefault(),t.stopPropagation(),n.click();return}const s=t.target.closest(".skin-card");if(s&&document.activeElement===s){t.preventDefault();const i=s.dataset.skinId;if(i){const a=this.getSkinById(i);a&&this.modal&&this.modal.open(a)}}}}))}getSkinById(e){return this.allSkins.find(t=>t.skin_id==e)}updateStats(){try{const e=this.allSkins.length,t=new Set(this.allSkins.map(o=>o.champion)).size,n=this.favorites.size,s=this.allSkins.filter(o=>o.isChroma).length,i=e-s,a=document.getElementById("favoritesCount");a&&(a.textContent=n);const r=document.getElementById("heroTotalSkins"),d=document.getElementById("heroTotalChamps");r&&(r.textContent=i.toLocaleString()),d&&(d.textContent=t.toLocaleString());const f=document.getElementById("footerStats");f&&(f.textContent=`${i.toLocaleString()} Skins • ${t} Champions • ${s} Chromas`);const m=this.allSkins.filter(o=>o.price>0&&o.price<99999),h=(o,c,u)=>{const p=document.getElementById(o);if(p&&c){const v=p.querySelector(".stat-icon");v&&c.imagePath&&(v.style.backgroundImage=`url('${c.imagePath}')`);const S=p.querySelector(".stat-value");S&&(S.textContent=u||c.skin_name)}else if(p){const v=p.querySelector(".stat-value");v&&(v.textContent="N/A")}};if(m.length>0){const o=m.reduce((u,p)=>(u.price||0)>(p.price||0)?u:p);h("statMostExpensive",o,`${o.price} RP`);const c=m.reduce((u,p)=>(u.price||99999)<(p.price||99999)?u:p);h("statCheapest",c,`${c.price} RP`)}else h("statMostExpensive",null,"N/A"),h("statCheapest",null,"N/A");const l=this.allSkins.filter(o=>o.release_date);if(l.length>0){const o=l.reduce((c,u)=>(c.release_date||"")>(u.release_date||"")?c:u);h("statLatest",o,o.release_date)}else h("statLatest",null,"N/A")}catch(e){console.warn("Stats update warning:",e)}}updateAdminStats(){if(performance&&performance.memory){const t=Math.round(performance.memory.usedJSHeapSize/1024/1024),n=Math.round(performance.memory.jsHeapSizeLimit/1024/1024);document.getElementById("admin_memory").textContent=`${t} / ${n} MB`}else document.getElementById("admin_memory").textContent="Restricted";document.getElementById("admin_dom").textContent=document.getElementsByTagName("*").length,document.getElementById("admin_assets").textContent=document.images.length;const e=Math.round(performance.now());document.getElementById("admin_tti").textContent=`${e}ms`}}document.addEventListener("DOMContentLoaded",()=>{new I});
